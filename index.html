<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Pookie Tic-Tac-Toe ✨</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600&family=Poppins:wght@300;400;500;600&family=Baloo+2:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Fredoka', cursive;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }

        .theme-pookie {
            background: linear-gradient(135deg, #ff6b9d 0%, #ffd93d 50%, #6bcf7e 100%);
        }

        .theme-neon {
            background: linear-gradient(135deg, #0f0f23 0%, #1a0033 50%, #2d1b69 100%);
            color: #00ffff;
        }

        .theme-galaxy {
            background: linear-gradient(135deg, #000428 0%, #004e92 100%);
            color: white;
        }

        .theme-candy {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 25%, #fecfef 75%, #ff9a9e 100%);
        }

        .theme-forest {
            background: linear-gradient(135deg, #134e5e 0%, #71b280 100%);
            color: white;
        }

        .theme-minimal {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }

        .container {
            width: 100%;
            max-width: 400px;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .screen {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 30px 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            animation: slideIn 0.5s ease-out;
            position: relative;
            overflow: hidden;
        }

        .theme-neon .screen {
            background: rgba(15, 15, 35, 0.9);
            border: 2px solid rgba(0, 255, 255, 0.3);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
        }

        .theme-galaxy .screen {
            background: rgba(0, 4, 40, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .screen.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .coin-display {
            position: absolute;
            top: -15px;
            right: 20px;
            background: linear-gradient(45deg, #ffd700, #ffa500);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
            z-index: 10;
        }

        .title {
            font-size: 2.5em;
            font-weight: 600;
            background: linear-gradient(45deg, #ff6b9d, #ffd93d, #6bcf7e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .theme-neon .title {
            background: linear-gradient(45deg, #00ffff, #ff00ff, #ffff00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .subtitle {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 30px;
            font-weight: 400;
        }

        .theme-neon .subtitle {
            color: #00ffff;
        }

        .theme-galaxy .subtitle {
            color: #ccc;
        }

        .btn {
            width: 100%;
            padding: 15px 25px;
            margin: 10px 0;
            border: none;
            border-radius: 20px;
            font-family: 'Fredoka', cursive;
            font-size: 1.1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, #ff6b9d, #ffd93d);
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.3);
            position: relative;
            overflow: hidden;
        }

        .theme-neon .btn {
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .theme-galaxy .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(255, 107, 157, 0.4);
        }

        .theme-neon .btn:hover {
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.7);
        }

        .btn:active {
            transform: translateY(-1px); 
        }

        .btn-secondary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-customize {
            background: linear-gradient(45deg, #6bcf7e, #36d1dc);
            box-shadow: 0 8px 20px rgba(107, 207, 126, 0.3);
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 25px 0;
            background: linear-gradient(45deg, #ff6b9d, #ffd93d);
            padding: 8px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .theme-neon .game-board {
            background: linear-gradient(45deg, #00ffff, #ff00ff);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }

        .theme-galaxy .game-board {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .theme-candy .game-board {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
        }

        .theme-forest .game-board {
            background: linear-gradient(45deg, #134e5e, #71b280);
        }

        .cell {
            aspect-ratio: 1;
            border: none;
            border-radius: 15px;
            background: white;
            font-size: 2.5em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-family: 'Fredoka', cursive;
        }

        .theme-neon .cell {
            background: rgba(15, 15, 35, 0.9);
            color: #00ffff;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }

        .theme-galaxy .cell {
            background: rgba(0, 4, 40, 0.8);
            color: white;
        }

        .cell:hover:not(.taken) {
            background: #f0f8ff;
            transform: scale(1.05);
        }

        .theme-neon .cell:hover:not(.taken) {
            background: rgba(0, 255, 255, 0.1);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }

        .cell.taken {
            cursor: not-allowed;
        }

        .status {
            font-size: 1.3em;
            margin: 20px 0;
            font-weight: 500;
            color: #333;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-neon .status {
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .theme-galaxy .status {
            color: white;
        }

        .score-board {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            background: rgba(255,255,255,0.5);
            border-radius: 15px;
            padding: 15px;
        }

        .theme-neon .score-board {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
        }

        .score-item {
            text-align: center;
        }

        .score-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .theme-neon .score-label {
            color: #00ffff;
        }

        .score-value {
            font-size: 1.5em;
            font-weight: 600;
            color: #333;
        }

        .theme-neon .score-value {
            color: #00ffff;
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .theme-item {
            padding: 15px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500; 
            border: 2px solid transparent;
        }

        .theme-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .theme-item.selected {
            border: 2px solid #ff6b9d;
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
        }

        .theme-item.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .theme-item.locked::after {
            content: '🔒';
            position: absolute;
            top: 5px;
            right: 8px;
            font-size: 1.2em;
        }

        .coin-price {
            position: absolute;
            bottom: 5px;
            right: 8px;
            font-size: 0.8em;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
        }

        .theme-pookie-preview { background: linear-gradient(45deg, #ff6b9d, #ffd93d); }
        .theme-neon-preview { background: linear-gradient(45deg, #0f0f23, #00ffff); color: #00ffff; }
        .theme-galaxy-preview { background: linear-gradient(45deg, #000428, #004e92); color: white; }
        .theme-candy-preview { background: linear-gradient(45deg, #ff9a9e, #fecfef); }
        .theme-forest-preview { background: linear-gradient(45deg, #134e5e, #71b280); color: white; }
        .theme-minimal-preview { background: linear-gradient(45deg, #667eea, #764ba2); color: white; }

        .popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .popup-content {
            background: white;
            padding: 40px 30px;
            border-radius: 25px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            animation: popIn 0.5s ease-out;
            max-width: 300px;
            width: 90%;
        }

        @keyframes popIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(30px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .popup-title {
            font-size: 2.2em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .popup-message {
            font-size: 1.2em;
            margin-bottom: 25px;
            color: #666;
        }

        .win {
            background: linear-gradient(45deg, #ff6b9d, #ffd93d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .lose {
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .draw {
            background: linear-gradient(45deg, #6bcf7e, #36d1dc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .coin-animation {
            position: fixed;
            font-size: 1.5em;
            color: #ffd700;
            pointer-events: none;
            z-index: 1001;
            animation: coinFloat 2s ease-out forwards;
        }

        @keyframes coinFloat {
            0% {
                opacity: 1;
                transform: translateY(0px) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(1.2);
            }
        }

        .floating-emoji {
            position: absolute;
            font-size: 2em;
            animation: float 3s infinite ease-in-out;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .back-btn {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            box-shadow: 0 8px 20px rgba(255, 154, 158, 0.3);
            width: auto;
            padding: 10px 20px;
            margin: 15px 5px 5px 5px;
            font-size: 0.95em;
        }

        .reset-btn {
            background: linear-gradient(45deg, #ffeaa7, #fdcb6e);
            box-shadow: 0 8px 20px rgba(255, 234, 167, 0.3);
            width: auto;
            padding: 10px 20px;
            margin: 15px 5px 5px 5px;
            font-size: 0.95em;
        }

        .customization-section {
            margin: 20px 0;
            text-align: left;
        }

        .section-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }

        .theme-neon .section-title {
            color: #00ffff;
        }

        .style-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .style-option {
            padding: 10px 15px;
            border: 2px solid transparent;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.5);
            font-size: 1.5em;
        }

        .style-option.selected {
            border: 2px solid #ff6b9d;
            background: rgba(255, 107, 157, 0.2);
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }

            .title {
                font-size: 2.2em;
            }

            .cell {
                font-size: 2.2em;
            }

            .btn {
                font-size: 1em;
                padding: 12px 20px;
            }

            .screen {
                padding: 25px 20px;
            }

            .theme-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (min-width: 768px) {
            .container {
                max-width: 450px;
            }

            .cell {
                font-size: 3em;
            }

            .title {
                font-size: 3em;
            }

            .theme-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body class="theme-pookie">
    <div class="floating-emoji" style="top: 10%; left: 10%; animation-delay: 0s;">✨</div>
    <div class="floating-emoji" style="top: 20%; right: 15%; animation-delay: 1s;">💖</div>
    <div class="floating-emoji" style="bottom: 30%; left: 8%; animation-delay: 2s;">🌈</div>
    <div class="floating-emoji" style="bottom: 15%; right: 10%; animation-delay: 0.5s;">⭐</div>

    <div class="container">
        <div id="homeScreen" class="screen active">
            <div class="coin-display">
                💰 <span id="coinCount">0</span> coins
            </div>
            <h1 class="title">Ultimate Pookie</h1>
            <p class="subtitle">Ready to slay and earn coins? ✨💅</p>
            <button class="btn" onclick="showGameMode()">Single Player 🤖</button>
            <button class="btn btn-secondary" onclick="startTwoPlayer()">1 vs 1 👥</button>
            <button class="btn btn-customize" onclick="showCustomization()">Customize Game 🎨</button>
        </div>

        <div id="difficultyScreen" class="screen">
            <div class="coin-display">
                💰 <span id="coinCount2">0</span> coins
            </div>
            <h2 class="title" style="font-size: 2em;">Pick Your Challenge</h2>
            <p class="subtitle">How hard should the bot go? 😏</p>
            <button class="btn difficulty-btn" onclick="startSinglePlayer('easy')">Easy Mode 😴<br><small>+8 coins for win</small></button>
            <button class="btn difficulty-btn" onclick="startSinglePlayer('medium')">Medium 🧠<br><small>+10 coins for win</small></button>
            <button class="btn difficulty-btn" onclick="startSinglePlayer('hard')">Boss Level 🔥<br><small>+15 coins for win</small></button>
            <button class="btn back-btn" onclick="showHome()">Back ⬅️</button>
        </div>

        <div id="customizationScreen" class="screen">
            <div class="coin-display">
                💰 <span id="coinCount3">0</span> coins
            </div>
            <h2 class="title" style="font-size: 2em;">Customize Your Vibe</h2>
            
            <div class="customization-section">
                <div class="section-title">🎨 Choose Theme</div>
                <div class="theme-grid" id="themeGrid">
                    <div class="theme-item theme-pookie-preview selected" data-theme="pookie">
                        Pookie Vibes 🌸
                        <div class="coin-price">Free</div>
                    </div>
                    <div class="theme-item theme-neon-preview locked" data-theme="neon">
                        Neon Glow 💫
                        <div class="coin-price">50 💰</div>
                    </div>
                    <div class="theme-item theme-galaxy-preview locked" data-theme="galaxy">
                        Galaxy ⭐
                        <div class="coin-price">75 💰</div>
                    </div>
                    <div class="theme-item theme-candy-preview locked" data-theme="candy">
                        Candy Land 🍭
                        <div class="coin-price">60 💰</div>
                    </div>
                    <div class="theme-item theme-forest-preview locked" data-theme="forest">
                        Forest 🌲
                        <div class="coin-price">40 💰</div>
                    </div>
                    <div class="theme-item theme-minimal-preview locked" data-theme="minimal">
                        Minimal 🤍
                        <div class="coin-price">30 💰</div>
                    </div>
                </div>
            </div>

            <div class="customization-section">
                <div class="section-title">⚡ X & O Style</div>
                <div class="style-options">
                    <div class="style-option selected" data-style="classic">❌⭕</div>
                    <div class="style-option" data-style="hearts">💖💙</div>
                    <div class="style-option" data-style="stars">⭐🌟</div>
                    <div class="style-option" data-style="fire">🔥❄️</div>
                </div>
            </div>

            <button class="btn back-btn" onclick="showHome()">Back ⬅️</button>
        </div>

        <div id="gameScreen" class="screen">
            <div class="coin-display">
                💰 <span id="coinCount4">0</span> coins
            </div>
            <div class="score-board">
                <div class="score-item">
                    <div class="score-label" id="player1Label">You</div>
                    <div class="score-value" id="player1Score">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label">Draws</div>
                    <div class="score-value" id="drawScore">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label" id="player2Label">Bot</div>
                    <div class="score-value" id="player2Score">0</div>
                </div>
            </div>
            
            <div class="status" id="gameStatus">Your turn bestie! 💫</div>
            
            <div class="game-board" id="gameBoard">
                <button class="cell" onclick="makeMove(0)"></button>
                <button class="cell" onclick="makeMove(1)"></button>
                <button class="cell" onclick="makeMove(2)"></button>
                <button class="cell" onclick="makeMove(3)"></button>
                <button class="cell" onclick="makeMove(4)"></button>
                <button class="cell" onclick="makeMove(5)"></button>
                <button class="cell" onclick="makeMove(6)"></button>
                <button class="cell" onclick="makeMove(7)"></button>
                <button class="cell" onclick="makeMove(8)"></button>
            </div>

            <div>
                <button class="btn back-btn" onclick="showHome()">Home 🏠</button>
                <button class="btn reset-btn" onclick="resetGame()">New Game 🔄</button>
            </div>
        </div>
    </div>

    <div id="gamePopup" class="popup">
        <div class="popup-content">
            <div class="popup-title" id="popupTitle">You Win!</div>
            <div class="popup-message" id="popupMessage">You absolutely slayed! 💅✨</div>
            <div class="popup-message" id="coinReward" style="color: #ffd700; font-weight: 600;"></div>
            <button class="btn" onclick="closePopup()">Play Again! 💖</button>
        </div>
    </div>

    <div id="purchasePopup" class="popup">
        <div class="popup-content">
            <div class="popup-title">Unlock Theme? 🎨</div>
            <div class="popup-message" id="purchaseMessage">Do you want to unlock this theme?</div>
            <button class="btn" id="confirmPurchase">Yes! Unlock 💎</button>
            <button class="btn btn-secondary" onclick="closePurchasePopup()">Not now</button>
        </div>
    </div>

    <script>
        let currentPlayer = 'X';
        let gameBoard = ['', '', '', '', '', '', '', '', ''];
        let gameMode = 'single';
        let difficulty = 'medium';
        let gameActive = true;
        let scores = { player1: 0, player2: 0, draws: 0 };
        let coins = 0;
        let currentTheme = 'pookie';
        let currentStyle = 'classic';
        let selectedThemeForPurchase = '';

        const themes = {
            pookie: { name: 'Pookie Vibes 🌸', cost: 0, unlocked: true },
            neon: { name: 'Neon Glow 💫', cost: 50, unlocked: false },
            galaxy: { name: 'Galaxy ⭐', cost: 75, unlocked: false },
            candy: { name: 'Candy Land 🍭', cost: 60, unlocked: false },
            forest: { name: 'Forest 🌲', cost: 40, unlocked: false },
            minimal: { name: 'Minimal 🤍', cost: 30, unlocked: false }
        };

        const styles = {
            classic: ['❌', '⭕'],
            hearts: ['💖', '💙'],
            stars: ['⭐', '🌟'],
            fire: ['🔥', '❄️'],
            letter: ['M', 'N']
        };

        const coinRewards = {
            easy: { win: 8, lose: 2 },
            medium: { win: 10, lose: 3 },
            hard: { win: 15, lose: 5 },
            two: { win: 12, lose: 4 }
        };

        const messages = {
            win: [
                "You absolutely slayed! 💅✨",
                "Period! That was iconic! 👑💫", 
                "Main character energy! 🌟✨",
                "You served and left no crumbs! 🔥💯",
                "Periodt! You're unstoppable! 💪👑"
            ],
            lose: [
                "Oop! Not your day bestie 😔💔",
                "It's giving second place vibes 😅💕",
                "Plot twist! Better luck next time! 🎭✨",
                "Don't worry, you're still that girl! 💖🫶"
            ],
            draw: [
                "It's giving stalemate energy! 😎🤝",
                "A tie? That's so fetch! ⚖️✨",
                "Perfectly balanced! 💯🌈",
                "Both queens won today! 👸👸"
            ],
            playerTurn: [
                "Your turn bestie! 💫",
                "Show them what you got! ✨",
                "Make your move queen! 👑",
                "Time to serve looks! 💅"
            ],
            botTurn: [
                "Bot is thinking... 🤔💭",
                "AI is plotting! 🤖✨",
                "Computer's turn! 💻",
                "Bot mode activated! 🔥"
            ],
            player2Turn: [
                "Player 2's turn! 🎮",
                "Your move bestie! 💖",
                "Time to shine! ⭐",
                "Go off! 🔥"
            ]
        };

        const winPatterns = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], 
            [0, 3, 6], [1, 4, 7], [2, 5, 8], 
            [0, 4, 8], [2, 4, 6] 
        ];

        window.onload = function() {
            loadGameData();
            updateCoinDisplays();
            updateThemeSelection();
            updateStyleSelection();
            applyTheme(currentTheme);
        };

        function saveGameData() {
            const gameData = {
                coins: coins,
                themes: themes,
                currentTheme: currentTheme,
                currentStyle: currentStyle,
                scores: scores
            };
            localStorage.setItem('pookieTicTacToe', JSON.stringify(gameData));
        }

        function loadGameData() {
            const saved = localStorage.getItem('pookieTicTacToe');
            if (saved) {
                const gameData = JSON.parse(saved);
                coins = gameData.coins || 0;
                Object.assign(themes, gameData.themes || themes);
                currentTheme = gameData.currentTheme || 'pookie';
                currentStyle = gameData.currentStyle || 'classic';
                scores = gameData.scores || { player1: 0, player2: 0, draws: 0 };
            }
        }

        function addCoins(amount) {
            coins += amount;
            updateCoinDisplays();
            saveGameData();
            
            showCoinAnimation(amount);
        }

        function updateCoinDisplays() {
            document.querySelectorAll('[id^="coinCount"]').forEach(el => {
                el.textContent = coins;
            });
        }

        function showCoinAnimation(amount) {
            const coinEl = document.createElement('div');
            coinEl.className = 'coin-animation';
            coinEl.textContent = `+${amount} 💰`;
            coinEl.style.left = '50%';
            coinEl.style.top = '50%';
            document.body.appendChild(coinEl);
            
            setTimeout(() => {
                document.body.removeChild(coinEl);
            }, 2000);
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function showHome() {
            showScreen('homeScreen');
            updateCoinDisplays();
        }

        function showGameMode() {
            showScreen('difficultyScreen');
        }

        function showCustomization() {
            showScreen('customizationScreen');
            updateThemeSelection();
            updateStyleSelection();
        }

        function startSinglePlayer(selectedDifficulty) {
            gameMode = 'single';
            difficulty = selectedDifficulty;
            document.getElementById('player2Label').textContent = 'Bot';
            initializeGame();
            showScreen('gameScreen');
        }

        function startTwoPlayer() {
            gameMode = 'two';
            document.getElementById('player2Label').textContent = 'Player 2';
            initializeGame();
            showScreen('gameScreen');
        }

        function applyTheme(themeName) {
            document.body.className = `theme-${themeName}`;
            currentTheme = themeName;
            saveGameData();
        }

        function updateThemeSelection() {
            document.querySelectorAll('.theme-item').forEach(item => {
                const theme = item.dataset.theme;
                item.classList.remove('selected', 'locked');
                
                if (theme === currentTheme) {
                    item.classList.add('selected');
                }
                
                if (!themes[theme].unlocked) {
                    item.classList.add('locked');
                }
                
                item.onclick = () => selectTheme(theme);
            });
        }

        function selectTheme(themeName) {
            if (!themes[themeName].unlocked) {
                if (coins >= themes[themeName].cost) {
                    selectedThemeForPurchase = themeName;
                    document.getElementById('purchaseMessage').textContent = 
                        `Unlock ${themes[themeName].name} for ${themes[themeName].cost} coins?`;
                    document.getElementById('purchasePopup').style.display = 'flex';
                } else {
                    showTempMessage('Not enough coins bestie! 💔');
                }
                return;
            }
            
            applyTheme(themeName);
            updateThemeSelection();
        }

        function confirmThemePurchase() {
            const theme = selectedThemeForPurchase;
            if (coins >= themes[theme].cost) {
                coins -= themes[theme].cost;
                themes[theme].unlocked = true;
                applyTheme(theme);
                updateCoinDisplays();
                updateThemeSelection();
                closePurchasePopup();
                showTempMessage('Theme unlocked! Slay queen! ✨');
                saveGameData();
            }
        }

        function closePurchasePopup() {
            document.getElementById('purchasePopup').style.display = 'none';
        }

        function updateStyleSelection() {
            document.querySelectorAll('.style-option').forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.style === currentStyle) {
                    option.classList.add('selected');
                }
                
                option.onclick = () => {
                    currentStyle = option.dataset.style;
                    updateStyleSelection();
                    saveGameData();
                };
            });
        }

        function initializeGame() {
            gameBoard = ['', '', '', '', '', '', '', '', ''];
            currentPlayer = 'X';
            gameActive = true;
            updateBoard();
            updateStatus();
        }

        function updateBoard() {
            const cells = document.querySelectorAll('.cell');
            const [xSymbol, oSymbol] = styles[currentStyle];
            
            cells.forEach((cell, index) => {
                cell.textContent = gameBoard[index] === 'X' ? xSymbol : gameBoard[index] === 'O' ? oSymbol : '';
                cell.classList.toggle('taken', gameBoard[index] !== '');
            });
        }

        function updateStatus() {
            const status = document.getElementById('gameStatus');
            if (!gameActive) return;

            if (gameMode === 'single') {
                if (currentPlayer === 'X') {
                    status.textContent = getRandomMessage('playerTurn');
                } else {
                    status.textContent = getRandomMessage('botTurn');
                }
            } else {
                if (currentPlayer === 'X') {
                    status.textContent = "Player 1's turn! ✨";
                } else {
                    status.textContent = getRandomMessage('player2Turn');
                }
            }
        }

        function getRandomMessage(type) {
            const messageArray = messages[type];
            return messageArray[Math.floor(Math.random() * messageArray.length)];
        }

        function makeMove(index) {
            if (gameBoard[index] !== '' || !gameActive) return;

            gameBoard[index] = currentPlayer;
            updateBoard();

            if (checkWin()) {
                endGame('win');
                return;
            }

            if (checkDraw()) {
                endGame('draw');
                return;
            }

            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            updateStatus();

            if (gameMode === 'single' && currentPlayer === 'O') {
                setTimeout(botMove, 800);
            }
        }

        function botMove() {
            if (!gameActive) return;

            let moveIndex;
            
            switch (difficulty) {
                case 'easy':
                    moveIndex = getRandomMove();
                    break;
                case 'medium':
                    moveIndex = Math.random() < 0.6 ? getBestMove() : getRandomMove();
                    break;
                case 'hard':
                    moveIndex = getBestMove();
                    break;
            }

            makeMove(moveIndex);
        }

        function getRandomMove() {
            const availableMoves = gameBoard
                .map((cell, index) => cell === '' ? index : null)
                .filter(index => index !== null);
            return availableMoves[Math.floor(Math.random() * availableMoves.length)];
        }

        function getBestMove() {
            for (let i = 0; i < 9; i++) {
                if (gameBoard[i] === '') {
                    gameBoard[i] = 'O';
                    if (checkWinForPlayer('O')) {
                        gameBoard[i] = '';
                        return i;
                    }
                    gameBoard[i] = '';
                }
            }

            for (let i = 0; i < 9; i++) {
                if (gameBoard[i] === '') {
                    gameBoard[i] = 'X';
                    if (checkWinForPlayer('X')) {
                        gameBoard[i] = '';
                        return i;
                    }
                    gameBoard[i] = '';
                }
            }
    
            if (gameBoard[4] === '') return 4;

            const corners = [0, 2, 6, 8];
            const availableCorners = corners.filter(i => gameBoard[i] === '');
            if (availableCorners.length > 0) {
                return availableCorners[Math.floor(Math.random() * availableCorners.length)];
            }

            return getRandomMove();
        }

        function checkWin() {
            return checkWinForPlayer(currentPlayer);
        }

        function checkWinForPlayer(player) {
            return winPatterns.some(pattern => 
                pattern.every(index => gameBoard[index] === player)
            );
        }

        function checkDraw() {
            return gameBoard.every(cell => cell !== '');
        }

        function endGame(result) {
            gameActive = false;
            
            setTimeout(() => {
                let coinReward = 0;
                let title, message;
                
                if (result === 'win') {
                    if (gameMode === 'single') {
                        if (currentPlayer === 'X') {
                            scores.player1++;
                            coinReward = coinRewards[difficulty].win;
                            title = 'You Win!';
                            message = getRandomMessage('win');
                        } else {
                            scores.player2++;
                            coinReward = coinRewards[difficulty].lose;
                            title = 'You Lose!';
                            message = getRandomMessage('lose');
                        }
                    } else {
                        if (currentPlayer === 'X') {
                            scores.player1++;
                            coinReward = coinRewards.two.win;
                            title = 'Player 1 Wins!';
                            message = getRandomMessage('win');
                        } else {
                            scores.player2++;
                            coinReward = coinRewards.two.win;
                            title = 'Player 2 Wins!';
                            message = getRandomMessage('win');
                        }
                    }
                } else if (result === 'draw') {
                    scores.draws++;
                    coinReward = 5;
                    title = "It's a Draw!";
                    message = getRandomMessage('draw');
                }
                
                addCoins(coinReward);
                showPopup(title, message, result, coinReward);
                updateScoreBoard();
            }, 500);
        }

        function showPopup(title, message, type, coinAmount) {
            document.getElementById('popupTitle').textContent = title;
            document.getElementById('popupTitle').className = `popup-title ${type}`;
            document.getElementById('popupMessage').textContent = message;
            document.getElementById('coinReward').textContent = `+${coinAmount} coins earned! 💰`;
            document.getElementById('gamePopup').style.display = 'flex';
        }

        function closePopup() {
            document.getElementById('gamePopup').style.display = 'none';
            resetGame();
        }

        function resetGame() {
            initializeGame();
        }

        function updateScoreBoard() {
            document.getElementById('player1Score').textContent = scores.player1;
            document.getElementById('player2Score').textContent = scores.player2;
            document.getElementById('drawScore').textContent = scores.draws;
        }

        function showTempMessage(msg) {
            const tempMsg = document.createElement('div');
            tempMsg.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #ff6b9d;
                color: white;
                padding: 15px 25px;
                border-radius: 25px;
                font-weight: 500;
                z-index: 1002;
                animation: slideDown 0.3s ease-out;
            `;
            tempMsg.textContent = msg;
            document.body.appendChild(tempMsg);
            
            setTimeout(() => {
                tempMsg.style.animation = 'slideUp 0.3s ease-out forwards';
                setTimeout(() => document.body.removeChild(tempMsg), 300);
            }, 2000);
        }

        document.getElementById('confirmPurchase').onclick = confirmThemePurchase;

        updateScoreBoard();
        
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
                to { opacity: 1; transform: translateX(-50%) translateY(0); }
            }
            @keyframes slideUp {
                from { opacity: 1; transform: translateX(-50%) translateY(0); }
                to { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
